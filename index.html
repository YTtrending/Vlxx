<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VLXX VIDEOS</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .video-card { transition: transform 0.2s; width: 100%; }
        .video-card:hover { transform: scale(1.02); }
        .pagination-btn { 
            padding: 10px 20px; 
            margin: 0 4px; 
            font-size: 1rem; 
            border-radius: 8px; 
            touch-action: manipulation; 
        }
        .pagination-btn.active { background-color: #2563eb; color: white; }
        .pagination-btn:disabled { background-color: #4b5563; cursor: not-allowed; }
        .page-input { width: 60px; padding: 8px; border: 1px solid #4b5563; border-radius: 8px; }
        .thumbnail { width: 100%; max-width: 100%; height: auto; display: block; }
        .thumbnail-container { width: 100%; padding: 0; }
        .filter-box { max-width: 100%; }
        .video-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.25rem; }
        .description { display: inline; }
        .read-more { display: inline; margin-left: 0.25rem; white-space: nowrap; }
        .description-container { display: block; }
        .stats-container { display: flex; gap: 0.5rem; align-items: center; }
        .video-content { display: flex; flex-direction: column; justify-content: flex-start; align-items: flex-start; width: 100%; }
        .video-title { white-space: normal; word-wrap: break-word; width: 100%; }
        @media (max-width: 640px) {
            .video-card { flex-direction: column; padding: 0.125rem; }
            .video-card .ml-4 { margin-left: 0; margin-top: 0.125rem; }
            .text-xl { font-size: 0.625rem; line-height: 1.1; }
            .text-sm { font-size: 0.875rem; line-height: 1.1; }
            .text-xs { font-size: 0.625rem; line-height: 1.1; }
            .read-more { line-height: 1.1; }
            .pagination-btn { padding: 6px 12px; font-size: 0.75rem; }
            .page-input { width: 40px; padding: 4px; }
            .video-grid { gap: 0.25rem; }
            .description-container, .stats-container { margin-top: 0.125rem; }
        }
        @media (min-width: 641px) and (max-width: 1024px) {
            .video-card { flex-direction: column; padding: 0.5rem; }
            .video-card .ml-4 { margin-left: 0; margin-top: 0.25rem; }
            .text-xl { font-size: 1rem; line-height: 1.1; }
            .text-sm { font-size: 1.125rem; line-height: 1.1; }
            .text-xs { font-size: 0.875rem; line-height: 1.1; }
            .read-more { line-height: 1.1; }
            .pagination-btn { padding: 10px 20px; font-size: 1rem; }
            .page-input { width: 60px; padding: 8px; }
            .video-grid { grid-template-columns: repeat(4, 1fr); gap: 1rem; }
            .description-container, .stats-container { margin-top: 0.25rem; }
        }
        @media (min-width: 1025px) {
            .video-card { flex-direction: column; padding: 0.75rem; }
            .video-card .ml-4 { margin-left: 0; margin-top: 0.25rem; }
            .text-xl { font-size: 1.125rem; line-height: 1.1; }
            .text-sm { font-size: 1.25rem; line-height: 1.1; }
            .text-xs { font-size: 1rem; line-height: 1.1; }
            .read-more { line-height: 1.1; }
            .pagination-btn { padding: 12px 24px; font-size: 1.125rem; }
            .page-input { width: 70px; padding: 10px; }
            .video-grid { grid-template-columns: repeat(5, 1fr); gap: 1.5rem; }
            .description-container, .stats-container { margin-top: 0.25rem; }
        }
        /* Popup styles */
        #popup-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: flex-start;
        }
        .popup-content {
            background-color: #1f2937;
            margin: 2rem auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 700px;
            border-radius: 8px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            touch-action: pan-y;
            -webkit-overflow-scrolling: touch;
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        #popup-title {
            font-size: 1.5rem;
            line-height: 1.2;
        }
        @media (min-width: 641px) {
            #popup-title {
                font-size: 2rem;
            }
        }
        #popup-thumbnail {
            max-height: 400px;
            object-fit: cover;
        }
        body.no-scroll {
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-900">
    <div class="container mx-auto">
        <h1 class="text-2xl font-bold mb-4 text-center text-white sm:text-3xl">VLXX VIDEOS</h1>
        <div class="mb-4 flex justify-center">
            <select id="sort-select" class="filter-box p-2 border rounded-lg bg-gray-800 text-white text-sm sm:text-base">
                <option value="id">Sort by Time (Newest)</option>
                <option value="views">Sort by Views</option>
                <option value="likes">Sort by Likes</option>
                <option value="rating">Sort by Rating</option>
            </select>
        </div>
        <div id="top-pagination" class="flex justify-center mb-6 space-x-2 flex-wrap"></div>
        <div id="video-list" class="video-grid"></div>
        <div id="bottom-pagination" class="flex justify-center mt-6 space-x-2 flex-wrap"></div>
    </div>

    <!-- Popup Modal -->
    <div id="popup-modal">
        <div class="popup-content">
            <span class="close-btn">&times;</span>
            <a id="popup-link" href="" target="_blank">
                <img id="popup-thumbnail" src="" alt="" class="w-full h-auto mb-4 rounded">
            </a>
            <a id="popup-title-link" href="" target="_blank">
                <h2 id="popup-title" class="text-xl font-bold text-white mb-2 hover:underline"></h2>
            </a>
            <p id="popup-description" class="text-gray-300 mb-4"></p>
            <div class="stats-container text-gray-500">
                <span id="popup-views"></span>
                <span> • </span>
                <span id="popup-likes"></span>
                <span> • </span>
                <span id="popup-rating"></span>
            </div>
        </div>
    </div>

    <script>
        async function loadVideos() {
            let data;
            try {
                // Try fetching JSON data from data.txt with UTF-8 encoding
                const response = await fetch('data.txt', {
                    headers: { 'Content-Type': 'application/json; charset=utf-8' }
                });
                if (!response.ok) throw new Error('Failed to load data.txt');
                data = await response.json();
            } catch (error) {
                console.warn('Error loading data.txt, using fallback data:', error);
                // Fallback to simplified sample data with properly escaped description
                data = [
                    {
                        "id": 2962,
                        "title": "Trốn trong tủ nhìn vợ mình \"cưỡi ngựa\" cùng cấp dưới",
                        "link": "https://vlxx.bz/video/tron-trong-tu-nhin-vo-minh-cuoi-ngua-cung-cap-duoi/2962/",
                        "thumbnail": "https://vlxx.bz/img2/2962.jpg",
                        "description": "Tôi và Eimi quen nhau qua một người quen và tiến tới hôn nhân chỉ sau sáu tháng. Lúc mới cưới, bố mẹ của cả hai đều phản đối, nên Eimi và tôi quyết định sẽ có con sau khi tôi được thăng chức. Kinjo là hậu bối của tôi ở công ty, là người vô trách nhiệm, thường xuyên gây chuyện khiến tôi phải vất vả đi xử lý hậu quả. Hôm nay cậu ta làm bẩn quần áo, nhà tôi ở gần đó nên tôi đưa cậu ta về nhà tôi thay đồ. Cũng từ lần đó, Eimi bắt đầu cư xử kỳ lạ, dường như cô ấy đang dần xa cách tôi hơn. Hơn nữa, tô...",
                        "views": 646200,
                        "likes": 1200,
                        "rating": 4.5
                    },
                    {
                        "id": 2961,
                        "title": "Chị dâu, em chỉ đút cặc vào lồn chị... 3cm thôi",
                        "link": "https://vlxx.bz/video/chi-dau-em-chi-dut-cac-vao-lon-chi-3cm-thoi/2961/",
                        "thumbnail": "https://vlxx.bz/img2/2961.jpg",
                        "description": "Anh trai và chị dâu Eimi của Yuji chuẩn bị về sống chung với cả nhà. Chị dâu Eimi vừa tốt bụng, lại vô cùng xinh đẹp khiến Yuji đã phải lòng cô ngay từ lần đầu gặp mặt. Khi không thể kìm nén cảm xúc của bản thân được nữa, Yuji đã mạnh dạn thổ lộ với Eimi nhưng bị từ chối. Không bỏ cuộc, Yuji liên tục thổ lộ với Eimi, cầu xin cô cho cậu hôn một lần thôi, Eimi miễn cưỡng đồng ý. Nhưng từ hôn, Yuji bắt đầu đòi hỏi nhiều hơn, đến bú cặc, đến đút cặc vào trong lồn của cô 3 cm thôi! Nhưng dù chỉ đút v...",
                        "views": 1400000,
                        "likes": 2500,
                        "rating": 4.8
                    },
                    {
                        "page": 2,
                        "id": 2929,
                        "title": "Thợ săn trai tân",
                        "link": "https://vlxx.bz/video/tho-san-trai-tan/2929/",
                        "thumbnail": "https://vlxx.bz/img2/2929.jpg",
                        "ribbon": "Vietsub",
                        "video_id": "2929",
                        "likes": 3737,
                        "dislikes": 3114,
                        "rating": 55,
                        "views": 3300000,
                        "video_code": "CAWD-827",
                        "video_link": "vlxx.bz/2929",
                        "description": "Mayuki có sở thích lấy đi lần đầu của các cậu trai trẻ, vì vậy mà cô có biệt danh là \"thợ săn trai tân\". Mayuki thường xuyên lên các ứng dụng hẹn hò để tìm kiếm mục tiêu. Với trình độ của cô, chỉ cần xem qua profile là có thể xác định được người đó có phải là trai tân hay không. Hôm nay Mayuki gặp được một profile vô cùng \"quê mùa\", xác định được đối phương là trai tân, Mayuki liền nhắn tin đề nghị gặp mặt. Qua vẻ mặt hồi hộp, cử chỉ tiếp xúc thân mật vụng về của đối phương, Mayuki càng hài lòng và quyết định cho cậu ta một đêm không thể nào quên. Khi đến khách sạn, Mayuki đã bị bất ngờ bởi con cặc bự của cậu trai trẻ. Khi bắt đầu \"hành sự\", cậu thanh niên nhanh chóng không chịu nổi mà bất ngờ bắn tinh vào ngập lồn của Mayuki. Chuyện này cũng thường xảy ra, Mayuki chỉ hy vọng đêm nay cậu ta bắn được hai phát là tốt rồi. Ai ngờ chưa kịp nghỉ ngơi, cậu ta liền lập tức đút cặc vào lại trong lồn của Mayuki, điều bất ngờ hơn nữa là con cặc của cậu ta vẫn còn cứng ngắc dù vừa mới bắn tinh.",
                        "actress": "Mayuki Ito"
                    }
                ];
            }

            const videosPerPage = 30;
            let currentPage = 1;
            let sortBy = 'id';
            let scrollPosition = 0;

            // Get page from URL or localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const pageFromUrl = parseInt(urlParams.get('page'));
            const pageFromStorage = parseInt(localStorage.getItem('lastPage'));
            if (pageFromUrl && !isNaN(pageFromUrl)) {
                currentPage = pageFromUrl;
            } else if (pageFromStorage && !isNaN(pageFromStorage)) {
                currentPage = pageFromStorage;
            }

            // Sorting function
            function sortVideos() {
                data.sort((a, b) => {
                    if (sortBy === 'id') return parseInt(b.id) - parseInt(a.id);
                    if (sortBy === 'views') return parseFloat(b.views) - parseFloat(a.views);
                    if (sortBy === 'likes') return parseFloat(b.likes || 0) - parseFloat(a.likes || 0);
                    if (sortBy === 'rating') return parseFloat(b.rating || 0) - parseFloat(a.rating || 0);
                    return 0;
                });
            }

            // Initial sort
            sortVideos();

            // Handle sort change
            document.getElementById('sort-select').addEventListener('change', (e) => {
                sortBy = e.target.value;
                currentPage = 1; // Reset to page 1 on sort change
                localStorage.setItem('lastPage', currentPage);
                history.pushState(null, '', `?page=${currentPage}`);
                sortVideos();
                displayVideos(currentPage);
            });

            function displayVideos(page) {
                const start = (page - 1) * videosPerPage;
                const end = start + videosPerPage;
                const paginatedVideos = data.slice(start, end);

                const videoList = document.getElementById('video-list');
                videoList.innerHTML = '';

                paginatedVideos.forEach(video => {
                    const videoCard = document.createElement('div');
                    videoCard.className = 'video-card bg-gray-800 rounded-lg shadow-md flex flex-col';
                    videoCard.innerHTML = `
                        <div class="thumbnail-container">
                            <a href="${video.link}" target="_blank" class="flex-shrink-0 w-full">
                                <img src="${video.thumbnail}" alt="${video.title}" class="thumbnail object-cover rounded-t">
                            </a>
                        </div>
                        <div class="video-content p-2">
                            <a href="${video.link}" target="_blank" class="video-title text-lg font-bold text-white hover:underline sm:text-xl">${video.title}</a>
                            <div class="description-container mt-2">
                                <p class="text-gray-300 text-sm description" data-full="${video.description.replace(/"/g, '&quot;')}">${video.description.substring(0, 100)}...</p>
                                <button class="read-more text-blue-400 text-sm hover:underline">Xem thêm</button>
                            </div>
                            <div class="stats-container text-gray-500 text-xs sm:text-sm mt-2">
                                <span>👁️ ${formatViews(video.views)}</span>
                                <span> • </span>
                                <span>❤️ ${video.likes || 0}</span>
                                <span> • </span>
                                <span>⭐ ${video.rating || 0}</span>
                            </div>
                        </div>
                    `;
                    videoList.appendChild(videoCard);
                });

                // Add event listeners for "Xem thêm" buttons
                document.querySelectorAll('.read-more').forEach(button => {
                    button.addEventListener('click', () => {
                        const description = button.previousElementSibling;
                        const fullText = description.dataset.full;
                        const videoCard = button.closest('.video-card');
                        const title = videoCard.querySelector('.video-title').textContent;
                        const thumbnail = videoCard.querySelector('.thumbnail').src;
                        const link = videoCard.querySelector('.video-title').href;
                        const views = formatViews(videoCard.querySelector('.stats-container span:nth-child(1)').textContent.replace('👁️ ', ''));
                        const likes = videoCard.querySelector('.stats-container span:nth-child(3)').textContent.replace('❤️ ', '');
                        const rating = videoCard.querySelector('.stats-container span:nth-child(5)').textContent.replace('⭐ ', '');

                        // Save current scroll position of the main page
                        scrollPosition = window.scrollY;

                        // Populate popup
                        document.getElementById('popup-thumbnail').src = thumbnail;
                        document.getElementById('popup-title').textContent = title;
                        document.getElementById('popup-link').href = link;
                        document.getElementById('popup-title-link').href = link;
                        document.getElementById('popup-description').textContent = fullText;
                        document.getElementById('popup-views').textContent = `👁️ ${views}`;
                        document.getElementById('popup-likes').textContent = `❤️ ${likes}`;
                        document.getElementById('popup-rating').textContent = `⭐ ${rating}`;

                        // Show popup, lock body scroll, and reset popup scroll to top
                        document.body.classList.add('no-scroll');
                        document.getElementById('popup-modal').style.display = 'flex';
                        document.querySelector('.popup-content').scrollTop = 0; // Reset popup scroll to top
                    });
                });

                updatePagination();
                // Scroll to top of page only for pagination/sort changes
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            function formatViews(views) {
                if (typeof views === 'string') views = parseFloat(views.replace(/[^0-9.]/g, '')) * (views.includes('M') ? 1000000 : views.includes('K') ? 1000 : 1);
                if (views >= 1000000) return (views / 1000000).toFixed(1) + 'M';
                if (views >= 1000) return (views / 1000).toFixed(1) + 'K';
                return views.toLocaleString();
            }

            function updatePagination() {
                const totalPages = Math.ceil(data.length / videosPerPage);
                const paginationContainers = ['top-pagination', 'bottom-pagination'];

                paginationContainers.forEach(containerId => {
                    const pagination = document.getElementById(containerId);
                    pagination.innerHTML = '';

                    // Previous button
                    const prevBtn = document.createElement('button');
                    prevBtn.className = 'pagination-btn bg-gray-700 text-white rounded';
                    prevBtn.textContent = 'Previous';
                    prevBtn.disabled = currentPage === 1;
                    prevBtn.addEventListener('click', () => {
                        if (currentPage > 1) {
                            currentPage--;
                            localStorage.setItem('lastPage', currentPage);
                            history.pushState(null, '', `?page=${currentPage}`);
                            displayVideos(currentPage);
                        }
                    });
                    pagination.appendChild(prevBtn);

                    // Page numbers: show ±3 pages and +5, +10, +20, +50, +100
                    const pageNumbers = new Set();
                    for (let i = Math.max(1, currentPage - 3); i <= Math.min(totalPages, currentPage + 3); i++) {
                        pageNumbers.add(i);
                    }
                    const offsets = [5, 10, 20, 50, 100];
                    offsets.forEach(offset => {
                        if (currentPage + offset <= totalPages) {
                            pageNumbers.add(currentPage + offset);
                        }
                    });
                    pageNumbers.add(1);
                    pageNumbers.add(totalPages);

                    Array.from(pageNumbers).sort((a, b) => a - b).forEach(i => {
                        const pageBtn = document.createElement('button');
                        pageBtn.className = `pagination-btn bg-gray-700 text-white rounded ${i === currentPage ? 'active' : ''}`;
                        pageBtn.textContent = i;
                        pageBtn.addEventListener('click', () => {
                            currentPage = i;
                            localStorage.setItem('lastPage', currentPage);
                            history.pushState(null, '', `?page=${currentPage}`);
                            displayVideos(currentPage);
                        });
                        pagination.appendChild(pageBtn);
                    });

                    // Next button
                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'pagination-btn bg-gray-700 text-white rounded';
                    nextBtn.textContent = 'Next';
                    nextBtn.disabled = currentPage === totalPages;
                    nextBtn.addEventListener('click', () => {
                        if (currentPage < totalPages) {
                            currentPage++;
                            localStorage.setItem('lastPage', currentPage);
                            history.pushState(null, '', `?page=${currentPage}`);
                            displayVideos(currentPage);
                        }
                    });
                    pagination.appendChild(nextBtn);

                    // Page input
                    const pageInput = document.createElement('input');
                    pageInput.type = 'number';
                    pageInput.min = 1;
                    pageInput.max = totalPages;
                    pageInput.value = currentPage;
                    pageInput.className = 'page-input bg-gray-800 text-white';
                    pageInput.addEventListener('change', () => {
                        let newPage = parseInt(pageInput.value);
                        if (newPage >= 1 && newPage <= totalPages) {
                            currentPage = newPage;
                            localStorage.setItem('lastPage', currentPage);
                            history.pushState(null, '', `?page=${currentPage}`);
                            displayVideos(currentPage);
                        } else {
                            pageInput.value = currentPage;
                        }
                    });
                    pagination.appendChild(pageInput);
                });
            }

            // Popup handling
            const modal = document.getElementById('popup-modal');
            const closeBtn = document.querySelector('.close-btn');

            // Close on click outside or close button
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                    document.body.classList.remove('no-scroll');
                    window.scrollTo({ top: scrollPosition, behavior: 'instant' });
                }
            });

            closeBtn.addEventListener('click', () => {
                modal.style.display = 'none';
                document.body.classList.remove('no-scroll');
                window.scrollTo({ top: scrollPosition, behavior: 'instant' });
            });

            // Swipe handling for popup
            let touchStartY = 0;
            let touchStartTime = 0;
            const popupContent = document.querySelector('.popup-content');

            popupContent.addEventListener('touchstart', (e) => {
                touchStartY = e.changedTouches[0].screenY;
                touchStartTime = Date.now();
            });

            popupContent.addEventListener('touchend', (e) => {
                const touchEndY = e.changedTouches[0].screenY;
                const touchDuration = Date.now() - touchStartTime;
                const distance = touchStartY - touchEndY;
                // Close popup only if swipe up is fast (duration < 300ms) and distance > 100px
                if (distance > 200 && touchDuration < 150) {
                    modal.style.display = 'none';
                    document.body.classList.remove('no-scroll');
                    window.scrollTo({ top: scrollPosition, behavior: 'instant' });
                }
            });

            displayVideos(currentPage);
        }

        // Load videos on page load
        window.onload = loadVideos;
    </script>
</body>
</html>
